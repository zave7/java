<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.kitri.cafe.board.dao.AlbumDao">
  	<insert id="writeArticle" parameterType="albumDto">
  		insert all
  			into board (seq, id, name, email, subject, content, hit, logtime, bcode)
  			values (#{seq}, #{id}, #{name}, #{email}, #{subject}, #{content}, 0, sysdate, #{bcode})
  			into album (aseq, seq, orign_picture, save_picture, savefolder, type)
  			values (album_aseq.nextval, #{seq}, #{originPicture}, #{savePicture}, #{saveFolder}, 0)
  		select * from dual
  	</insert>
  	<select id="viewArticle" parameterType="int" resultType="albumDto">
  		SELECT b.seq, b.id, b.name, b.email, b.subject, b.content, b.hit, b.logtime, b.bcode,
  			   a.aseq, a.orign_picture originPicture, a.save_picture savePicture, a.savefolder saveFolder, a.type
  		FROM board b, album a
  		WHERE b.seq = a.seq
  		AND b.seq = #{seq}
  	</select>
  	<select id="listArticle" parameterType="map" resultType="albumDto">
  		
	  		SELECT a.seq, a.id, a.name, a.email, a.subject, a.content, a.hit, a.bcode, 
	        decode(to_char(a.logtime, 'yymmdd'), to_char(sysdate, 'yymmdd'), 
	        to_char(a.logtime, 'hh24:mi:ss'), to_char(a.logtime, 'yy/mm/dd')) logtime,
	                c.aseq, c.orign_picture originPicture, c.save_picture savePicture, c.savefolder saveFolder, c.type
			FROM    
			        (SELECT rownum r, b.*
			        FROM 	(SELECT b.seq, b.id, b.name, b.email, b.subject, b.content, b.hit, b.bcode, b.logtime,
			                a.aseq, a.orign_picture originPicture, a.save_picture savePicture, a.savefolder saveFolder, a.type
			                FROM board b, album a
			                WHERE b.seq = a.seq
			                AND b.bcode = #{bcode}
			                
			                <if test="word != null and word != ''">
			                	<if test="key == 'subject'">
			                		and b.subject like '%'||#{word}||'%'
			                	</if>
			                	<if test="key != 'subject'">
			                		and b.${key} = #{word}
			                	</if>
			                </if>
			               
			                ORDER BY b.seq DESC) b
			<![CDATA[WHERE rownum < #{endRow}
			        ) a
			WHERE a.r >= #{startRow}]]>
  	</select>
  </mapper>